# ADR-002: Secrets Management

## Context
Текущая система не имеет централизованного управления секретами. Секреты могут попасть в код или логи.

## Decision
Реализовать безопасное управление секретами с использованием переменных окружения.

**Ключевые принципы:**
1. Никогда не хранить секреты в коде
2. Использовать переменные окружения для development
3. Маскировать секреты в логах
4. Планировать интеграцию с внешним хранилищем

## Alternatives
1. **Хранить секреты в коде**
   - Простота разработки
   - Критическая уязвимость безопасности

2. **Использовать конфигурационные файлы**
   - Централизованное управление
   - Риск попадания в git, нет маскирования

3. **Переменные окружения + маскирование**
   - Безопасность, простота
   - Маскирование в логах
   - Ограниченная ротация

## Implementation
```python
# app/core/secrets.py
class SecretsManager:
    def get_secret(self, key: str) -> str:
        value = os.getenv(key)
        if not value:
            raise ValueError(f"Secret {key} not found")
        return value

    def mask_secret(self, secret: str) -> str:
        return secret[:4] + "***" + secret[-4:]
```

## Consequences
- Безопасное хранение секретов вне кода
- Маскирование секретов в логах
- Дополнительная сложность в конфигурации

## Links
- **Tests**: `tests/test_secrets_management.py`

## Verification Criteria
- [ ] Все секреты загружаются из переменных окружения
- [ ] Секреты маскируются в логах
- [ ] Валидация секретов при старте приложения

## Rollout Plan
1. **Phase 1**: Создание SecretsManager класса
2. **Phase 2**: Внедрение маскирования в middleware
3. **Phase 3**: Валидация секретов при старте
4. **Phase 4**: Обновление всех компонентов для использования SecretsManager
5. **Phase 5**: Интеграция с внешним хранилищем (будущее)
